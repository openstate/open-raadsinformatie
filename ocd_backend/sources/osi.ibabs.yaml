# All underscored root keys are excluded
_defaults: &source_defaults
  hidden: false
  keep_index_on_update: true
  wait_until_finished: false
  es_prefix: osi

_entity_defaults: &entity_defaults
  id: "{index_name}_{entity}"
  transformer: ocd_backend.transformers.transformer
  loaders:
    - ocd_backend.loaders.elasticsearch.elasticsearch_upsert_loader
    - ocd_backend.loaders.delta.delta_loader
  cleanup: ocd_backend.tasks.cleanup_elasticsearch

_motions_and_amendments_voting_defaults: &motions_and_amendments_voting_defaults
  <<: *entity_defaults
  extractor: ocd_backend.extractors.ibabs.IBabsReportsExtractor
  item: ocd_backend.items.ibabs_motion.IBabsMotionItem
  loader: ocd_backend.loaders.ElasticsearchUpsertLoader
  include: moties
  pdf_max_pages: 20
  max_pages: 1
  per_page: 100

_voting_rounds_defaults: &voting_rounds_defaults
  <<: *entity_defaults
  entity: voting_rounds
  doc_type: vote_events
  extractor: ocd_backend.extractors.ibabs.IBabsVotesMeetingsExtractor
  item: ocd_backend.items.voting_round.IBabsVotingRoundItem
  loader: ocd_backend.loaders.ElasticsearchUpdateOnlyLoader
  reverse_chronological: false
  max_processed_meetings: 0

_entities: &entities
  - &province
    <<: *entity_defaults
    entity: province
    doc_type: organizations
    extractor: ocd_backend.extractors.allmanak.AllmanakProvinceExtractor
    item: ocd_backend.items.organizations.ProvinceOrganizationItem

  - &committees
    <<: *entity_defaults
    entity: committees
    doc_type: organizations
    extractor: ocd_backend.extractors.ibabs.IBabsCommitteesExtractor
    item: ocd_backend.items.ibabs_committee.CommitteeItem

  - &organizations
    <<: *entity_defaults
    entity: organizations
    doc_type: organizations
    extractor: ocd_backend.extractors.allmanak.AllmanakPartiesExtractor
    item: ocd_backend.items.organizations.PartyItem

  - &persons
    <<: *entity_defaults
    entity: persons
    doc_type: persons
    extractor: ocd_backend.extractors.ibabs.IbabsPersonsExtractor
    item: ocd_backend.items.ibabs_person.IbabsPersonItem

  - &meetings
    <<: *entity_defaults
    entity: meetings
    doc_type: events
    extractor: ocd_backend.extractors.ibabs.IBabsMeetingsExtractor
    item: ocd_backend.items.ibabs_meeting.IBabsMeetingItem

  - &reports
    <<: *entity_defaults
    entity: reports
    doc_type: events
    extractor: ocd_backend.extractors.ibabs.IBabsReportsExtractor
    item: ocd_backend.items.ibabs_meeting.IBabsReportItem
    include: ".*"
    pdf_max_pages: 0
    max_pages: 1

_entities_voting: &entities_voting
  - &province_voting
    <<: *province

  - &committees_voting
    <<: *committees

  - &organizations_voting
    <<: *entity_defaults
    entity: organizations
    doc_type: organizations
    extractor: ocd_backend.extractors.ibabs.IBabsMostRecentCompleteCouncilExtractor
    transformer: ocd_backend.transformers.transformer
    item: ocd_backend.items.popit.PopitOrganisationItem
    loader: ocd_backend.loaders.ElasticsearchUpsertLoader
    cleanup: ocd_backend.tasks.cleanup_elasticsearch
    vote_entity: organizations
    pdf_max_pages: 20
    council_members_count: 1
    reverse_chronological: true
    max_processed_meetings: 1

  - &persons_voting
    <<: *entity_defaults
    entity: persons
    doc_type: persons
    extractor: ocd_backend.extractors.ibabs.IBabsMostRecentCompleteCouncilExtractor
    transformer: ocd_backend.transformers.transformer
    item: ocd_backend.items.popit.PopitPersonItem
    loader: ocd_backend.loaders.ElasticsearchUpsertLoader
    cleanup: ocd_backend.tasks.cleanup_elasticsearch
    vote_entity: persons
    pdf_max_pages: 20
    council_members_count: 1
    reverse_chronological: true
    max_processed_meetings: 1

  - &meetings_voting
    <<: *meetings

  - &reports_voting
    <<: *reports
    include: ".*"
    exclude: (moties|amendementen)
    pdf_max_pages: 0
    max_pages: 1

_ibabs: &ibabs
  index_name: "{key}"
  sitename: "{key!c}"
  allmanak_api_version: "v0"
  entities: *entities
  <<: *source_defaults

_ibabs_voting: &ibabs_voting
  index_name: "{key}"
  sitename: "{key!c}"
  allmanak_api_version: "v0"
  entities: *entities_voting
  <<: *source_defaults

osi.ibabs:
  # Added before 17-11-2017
  noord-holland:
    key: noord-holland
    allmanak_id: 16412
    <<: *ibabs

  limburg:
    key: limburg
    allmanak_id: 16071

    _fields_limburg: &fields_limburg
      fields:
        Moties:
          id: Titel
          name: Titel
          creator: Hoofdindieners
          description: status
          start_date: Datum
        Amendementen:
          id: Titel
          name: Titel
          creator: Hoofdindieners
          description: status
          start_date: Datum
        Stemmingen:
          id: Titel
          name: Titel
          creator: Hoofdindieners
          description: status
          start_date: Datum

    <<: *ibabs_voting
    entities:
    - *province_voting
    - *committees_voting
    - *organizations_voting
    - *persons_voting
    - *meetings_voting
    - *reports_voting

    - &motions_voting
      entity: motions
      doc_type: motions
      classification: Moties
      include: moties
      exclude: "^$"
      <<: *fields_limburg
      <<: *motions_and_amendments_voting_defaults

    - &amendments_voting
      entity: amendments
      doc_type: motions
      classification: Amendementen
      include: amendementen
      exclude: "^$"
      <<: *fields_limburg
      <<: *motions_and_amendments_voting_defaults

    - &vote_events
      entity: vote_events
      doc_type: vote_events
      classification: Stemmingen
      include: (moties|amendementen)
      exclude: "^$"
      <<: *fields_limburg
      <<: *motions_and_amendments_voting_defaults

    - &voting_rounds
      <<: *voting_rounds_defaults
